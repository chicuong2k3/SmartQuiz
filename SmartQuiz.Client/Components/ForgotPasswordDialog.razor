@inject ISnackbar Snackbar
@inject IDialogService DialogService

<MudDialog>
    <DialogContent>
        <div style="padding: 24px 0;">
            <!-- Icon -->
            <div class="d-flex justify-center mb-4">
                <div style="background: #E3F2FD; border-radius: 50%; padding: 16px; display: inline-flex;">
                    <MudIcon Icon="@Icons.Material.Filled.Autorenew" Style="color: #2196F3; font-size: 40px;"/>
                </div>
            </div>

            <!-- Title -->
            <MudText Typo="Typo.h5" Style="font-weight: 700; color: #212121; text-align: center; margin-bottom: 12px;">
                Forgot Password?
            </MudText>

            <!-- Description -->
            <MudText Typo="Typo.body2"
                     Style="color: #757575; text-align: center; margin-bottom: 24px; line-height: 1.6;">
                No worries! Enter the email address associated with your account and we'll send you a link to reset your
                password.
            </MudText>

            <!-- Email Field -->
            <MudTextField
                    @bind-Value="_email"
                    Label="Email Address"
                    Variant="Variant.Outlined"
                    Margin="Margin.Dense"
                    FullWidth
                    Style="margin-bottom: 20px;"
                    Placeholder="name@example.com"
                    Adornment="Adornment.Start"
                    AdornmentIcon="@Icons.Material.Filled.Email"
                    AdornmentColor="Color.Default"/>

            <!-- Send Reset Link Button -->
            <MudButton
                    Variant="Variant.Filled"
                    Color="Color.Primary"
                    FullWidth
                    Size="Size.Large"
                    Style="border-radius: 8px; text-transform: none; font-weight: 600; padding: 12px; background-color: #2196F3; margin-bottom: 16px;"
                    OnClick="@HandleSendResetLink"
                    Disabled="@_isLoading">
                @if (_isLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" Style="color: white;"/>
                }
                else
                {
                    <text>Send Reset Link</text>
                }
            </MudButton>

            <!-- Back to Login Link -->
            <div class="text-center">
                <MudButton
                        Variant="Variant.Text"
                        StartIcon="@Icons.Material.Filled.ArrowBack"
                        Style="text-transform: none; color: #757575; font-size: 14px;"
                        OnClick="@(() => MudDialog.Close())">
                    Back to Login
                </MudButton>
            </div>

            <!-- Footer -->
            <MudText Typo="Typo.caption" Style="color: #9E9E9E; text-align: center; margin-top: 32px; font-size: 12px;">
                Â© 2026 QuizMaster App. All rights reserved.
            </MudText>
        </div>
    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = null!;

    private string _email = string.Empty;
    private bool _isLoading;

    private async Task HandleSendResetLink()
    {
        if (string.IsNullOrWhiteSpace(_email))
        {
            Snackbar.Add("Please enter your email address", Severity.Warning);
            return;
        }

        _isLoading = true;
        StateHasChanged();

        // Simulate API call
        await Task.Delay(1500);

        // TODO: Implement actual password reset logic

        _isLoading = false;

        // Close the forgot password dialog
        MudDialog.Close(DialogResult.Ok(true));

        // Show confirmation dialog
        var parameters = new DialogParameters
        {
                { "Email", _email },
                { "OnResend", EventCallback.Factory.Create(this, async () => await ResendResetLink()) }
        };

        var options = new DialogOptions
        {
                CloseButton = false,
                CloseOnEscapeKey = false,
                MaxWidth = MaxWidth.Small,
                FullWidth = true
        };

        await DialogService.ShowAsync<PasswordResetConfirmation>("", parameters, options);
    }

    private async Task ResendResetLink()
    {
        // TODO: Implement actual resend logic
        await Task.Delay(1000);
        Snackbar.Add("Password reset link has been resent!", Severity.Success);
    }

}

