@page "/login"
@inject NavigationManager NavigationManager
@inject IDialogService DialogService

<div class="min-h-screen flex items-center justify-center p-4"
     style="background: linear-gradient(135deg, #E3F2FD 0%, #FFF9C4 100%);">
    <MudPaper Elevation="3" Style="max-width: 400px; width: 100%; border-radius: 16px;" Class="pa-8">

        <!-- Logo and Title -->
        <div class="text-center mb-6">
            <div class="d-flex justify-center mb-3">
                <div style="background: #2196F3; border-radius: 12px; padding: 12px; display: inline-flex;">
                    <MudIcon Icon="@Icons.Material.Filled.Assignment" Style="color: white; font-size: 32px;"/>
                </div>
            </div>
            <MudText Typo="Typo.h5" Style="font-weight: 700; color: #212121; margin-bottom: 4px;">Welcome back to
                QuizMaster
            </MudText>
            <MudText Typo="Typo.body2" Style="color: #757575;">Log in to continue your streak</MudText>
        </div>

        <!-- Social Login Buttons -->
        <div class="d-flex gap-2 mb-4">
            <MudButton
                Variant="Variant.Outlined"
                Style="border: 1px solid #E0E0E0; border-radius: 8px; padding: 12px; flex: 1; min-width: 0;"
                OnClick="@(() => HandleExternalLogin("Google"))">
                <MudIcon Icon="@Icons.Custom.Brands.Google" Size="Size.Medium"/>
            </MudButton>

            <MudButton
                Variant="Variant.Outlined"
                Style="border: 1px solid #E0E0E0; border-radius: 8px; padding: 12px; flex: 1; min-width: 0;"
                OnClick="@(() => HandleExternalLogin("Facebook"))">
                <MudIcon Icon="@Icons.Custom.Brands.Facebook" Size="Size.Medium" Style="color: #1877F2;"/>
            </MudButton>

            <MudButton
                Variant="Variant.Outlined"
                Style="border: 1px solid #E0E0E0; border-radius: 8px; padding: 12px; flex: 1; min-width: 0;"
                OnClick="@(() => HandleExternalLogin("TikTok"))">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/>
                </svg>
            </MudButton>
        </div>

        <!-- Divider -->
        <div class="d-flex align-center gap-3 mb-4">
            <MudDivider Style="flex: 1;"/>
            <MudText Typo="Typo.caption"
                     Style="color: #9E9E9E; font-size: 11px; font-weight: 500; letter-spacing: 0.5px; white-space: nowrap;">
                OR LOGIN WITH EMAIL
            </MudText>
            <MudDivider Style="flex: 1;"/>
        </div>

        <!-- Email/Username Field -->
        <MudTextField
            @bind-Value="_email"
            Label="Email or Username"
            Variant="Variant.Outlined"
            Margin="Margin.Dense"
            FullWidth
            Style="margin-bottom: 16px; border-radius: 8px;"
            Placeholder="name@example.com"
            Adornment="Adornment.End"
            AdornmentIcon="@Icons.Material.Filled.Email"
            AdornmentColor="Color.Default"/>

        <!-- Password Field -->
        <MudTextField
            @bind-Value="_password"
            Label="Password"
            Variant="Variant.Outlined"
            Margin="Margin.Dense"
            FullWidth
            InputType="@_passwordInputType"
            Style="margin-bottom: 8px; border-radius: 8px;"
            Placeholder="Enter your password"
            Adornment="Adornment.End"
            AdornmentIcon="@_passwordIcon"
            AdornmentColor="Color.Default"
            OnAdornmentClick="TogglePasswordVisibility"/>

        <!-- Forgot Password Link -->
        <div class="text-right mb-4">
            <MudLink Typo="Typo.body2" Style="color: #FF9800; text-decoration: none; font-size: 14px; cursor: pointer;"
                     OnClick="OpenForgotPasswordDialog">
                Forgot Password?
            </MudLink>
        </div>

        <!-- Login Button -->
        <MudButton
            Variant="Variant.Filled"
            Color="Color.Primary"
            FullWidth
            Size="Size.Large"
            Style="border-radius: 8px; text-transform: none; font-weight: 600; padding: 12px; background-color: #2196F3;"
            OnClick="@HandleLogin"
            Disabled="@_isLoading">
            @if (_isLoading)
            {
                <MudProgressCircular Size="Size.Small" Indeterminate="true" Style="color: white;"/>
            }
            else
            {
                <text>Log In</text>
            }
        </MudButton>

        <!-- Sign Up Link -->
        <div class="text-center mt-4">
            <MudText Typo="Typo.body2" Style="color: #757575;">
                Don't have an account?
                <MudLink Href="/signup"
                         Style="color: #FF9800; text-decoration: none; font-weight: 600; margin-left: 4px;">Sign up
                </MudLink>
            </MudText>
        </div>

    </MudPaper>
</div>

@code {
    private string _email = string.Empty;
    private string _password = string.Empty;
    private bool _isLoading;
    private bool _passwordVisible;
    private InputType _passwordInputType = InputType.Password;
    private string _passwordIcon = Icons.Material.Filled.VisibilityOff;

    private void TogglePasswordVisibility()
    {
        _passwordVisible = !_passwordVisible;
        _passwordInputType = _passwordVisible ? InputType.Text : InputType.Password;
        _passwordIcon = _passwordVisible ? Icons.Material.Filled.Visibility : Icons.Material.Filled.VisibilityOff;
    }

    private async Task HandleLogin()
    {
        _isLoading = true;
        StateHasChanged();

        // Simulate API call
        await Task.Delay(1500);

        // TODO: Implement actual authentication logic
        NavigationManager.NavigateTo("/");

        _isLoading = false;
    }

    private void HandleExternalLogin(string provider)
    {
        NavigationManager.NavigateTo(
            $"/authentication/signin-{provider.ToLower()}",
            forceLoad: true);
    }

    private async Task OpenForgotPasswordDialog()
    {
        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Small,
            FullWidth = true,
            CloseButton = false,
            BackdropClick = true,
            CloseOnEscapeKey = true
        };

        await DialogService.ShowAsync<ForgotPasswordDialog>("", options);
    }
}
