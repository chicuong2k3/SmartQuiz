@using ActualLab.DependencyInjection
@using ActualLab.OS
@inherits CircuitHubComponentBase

<CascadingAuthState UsePresenceReporter="true">
    <Router AppAssembly="typeof(Program).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="routeData" DefaultLayout="typeof(MainLayout)">
                <NotAuthorized>
                    <p>Bạn cần đăng nhập để truy cập trang này.</p>
                </NotAuthorized>
            </AuthorizeRouteView>
        </Found>
    </Router>
</CascadingAuthState>

@code {
    private ISessionResolver SessionResolver => CircuitHub.SessionResolver;

    [Parameter] public string SessionId { get; set; } = string.Empty;

    protected override void OnInitialized()
    {
        if (OSInfo.IsWebAssembly)
        {
            SessionResolver.Session = Session.Default;
            var rootServices = Services.Commander().Services;
            _ = rootServices.HostedServices().Start();
        }
        else
        {
            SessionResolver.Session = new Session(SessionId);
        }

        if (CircuitHub.IsInteractive)
            CircuitHub.Initialize(this.GetDispatcher(), RenderModeDef.GetOrDefault("w"));
    }

}