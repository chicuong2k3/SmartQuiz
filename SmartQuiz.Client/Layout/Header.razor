@inject NavigationManager NavigationManager

<MudAppBar Elevation="1" Color="Color.Surface" Class="px-4"
           Style="background-color: white; border-bottom: 1px solid #e0e0e0;">
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex align-center justify-space-between pa-0">
        <div class="d-flex align-center gap-4">
            <MudText Typo="Typo.h5" Color="Color.Primary" Class="fw-bold" Style="cursor: pointer;"
                     @onclick="@(() => NavigationManager.NavigateTo("/"))">
                üéì SmartQuiz
            </MudText>

            <MudTextField
                @bind-Value="_searchQuery"
                Placeholder="Search for quizzes, sets, or topics..."
                Variant="Variant.Outlined"
                Adornment="Adornment.Start"
                AdornmentIcon="@Icons.Material.Filled.Search"
                Margin="Margin.Dense"
                Class="search-field"
                Style="width: 400px;"/>
        </div>

        <div class="d-flex align-center gap-3">
            <AuthorizeView>
                <Authorized>
                    <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Default"
                                   Size="Size.Medium"/>

                    <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight" Class="user-menu">
                        <ActivatorContent>
                            <MudButton Variant="Variant.Text" Class="pa-2" Style="text-transform: none;">
                                <div class="d-flex align-center gap-2">
                                    <MudText Typo="Typo.body1" Color="Color.Default">Alex Johnson</MudText>
                                    <MudAvatar Size="Size.Medium"
                                               Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                        <MudIcon Icon="@Icons.Material.Filled.Person"/>
                                    </MudAvatar>
                                    <MudIcon Icon="@Icons.Material.Filled.KeyboardArrowDown" Size="Size.Small"/>
                                </div>
                            </MudButton>
                        </ActivatorContent>
                        <ChildContent>
                            <!-- User Info Header -->
                            <div class="pa-4" style="border-bottom: 1px solid #e0e0e0;">
                                <div class="d-flex align-center gap-3">
                                    <MudAvatar Size="Size.Large"
                                               Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                        <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Large"/>
                                    </MudAvatar>
                                    <div>
                                        <MudText Typo="Typo.body1" Class="fw-bold">Alex Johnson</MudText>
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">alex.j@quizmaster.com
                                        </MudText>
                                        <MudChip T="string" Size="Size.Small" Color="Color.Info"
                                                 Style="text-transform: uppercase; font-size: 10px; height: 20px; margin-top: 4px;">
                                            LEVEL 5 QUIZZER
                                        </MudChip>
                                    </div>
                                </div>
                            </div>

                            <!-- Menu Items -->
                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/profile"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small"
                                             Color="Color.Default"/>
                                    <MudText Typo="Typo.body2">My Profile</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/quiz-history"))">
                                <div class="d-flex align-center gap-3 position-relative">
                                    <MudIcon Icon="@Icons.Material.Filled.History" Size="Size.Small"
                                             Color="Color.Default"/>
                                    <MudText Typo="Typo.body2">Quiz History</MudText>
                                    <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Info"
                                             Style="font-size: 8px; position: absolute; right: 0;"/>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/settings"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small"
                                             Color="Color.Default"/>
                                    <MudText Typo="Typo.body2">Settings</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/help"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Help" Size="Size.Small"
                                             Color="Color.Default"/>
                                    <MudText Typo="Typo.body2">Help & Support</MudText>
                                </div>
                            </MudMenuItem>

                            <MudDivider Class="my-2"/>

                            <MudMenuItem OnClick="@Logout">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Logout" Size="Size.Small"
                                             Color="Color.Error"/>
                                    <MudText Typo="Typo.body2" Color="Color.Error">Log Out</MudText>
                                </div>
                            </MudMenuItem>

                            <!-- Version Footer -->
                            <div class="pa-3 text-center" style="border-top: 1px solid #e0e0e0;">
                                <MudText Typo="Typo.caption" Color="Color.Secondary">v2.4.0</MudText>
                            </div>
                        </ChildContent>
                    </MudMenu>
                </Authorized>
                <NotAuthorized>
                    <MudButton Color="Color.Primary" Variant="Variant.Filled"
                               OnClick="@(() => NavigationManager.NavigateTo("/dang-nhap"))">
                        ƒêƒÉng nh·∫≠p
                    </MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </MudContainer>
</MudAppBar>

<style>
    .user-menu .mud-popover-paper {
        min-width: 280px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .search-field .mud-input-root {
        border-radius: 24px;
    }
</style>

@code {
    private string _searchQuery = "";

    private void Logout()
    {
        // Implement logout logic
        NavigationManager.NavigateTo("/logout", true);
    }

}

