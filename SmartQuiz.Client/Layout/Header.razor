@inject NavigationManager NavigationManager
@inject ClientAuthHelper ClientAuthHelper


<MudAppBar Elevation="0"
           Style="background-color: white; border-bottom: 1px solid #F0F0F0; height: 64px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex align-center justify-space-between pa-0">
        <div class="d-flex align-center gap-4">
            <!-- Logo -->
            <div class="d-flex align-center gap-2 cursor-pointer" @onclick="@(() => NavigationManager.NavigateTo("/"))">
                <MudIcon Icon="@Icons.Material.Filled.School" Style="color: #4255FF;" Size="Size.Large"/>
                <MudText Typo="Typo.h6" Class="fw-bold app-logo" Style="color: #4255FF;">QuizMaster</MudText>
            </div>

            <!-- Navigation Links -->
            <div class="d-flex align-center gap-1">
                <MudButton
                    Variant="Variant.Text"
                    OnClick="@(() => NavigationManager.NavigateTo("/"))"
                    Style="color: #586380; text-transform: none; font-weight: 600; padding: 8px 16px; border-radius: 8px;">
                    Home
                </MudButton>
                <MudButton
                    Variant="Variant.Text"
                    OnClick="@(() => NavigationManager.NavigateTo("/my-quizzes"))"
                    Style="color: #586380; text-transform: none; font-weight: 600; padding: 8px 16px; border-radius: 8px;">
                    My Quizzes
                </MudButton>
                <MudButton
                    Variant="Variant.Text"
                    OnClick="@(() => NavigationManager.NavigateTo("/browse"))"
                    Style="color: #586380; text-transform: none; font-weight: 600; padding: 8px 16px; border-radius: 8px;">
                    Browse
                </MudButton>
                <MudButton
                    Variant="Variant.Text"
                    OnClick="@(() => NavigationManager.NavigateTo("/create"))"
                    Style="color: #586380; text-transform: none; font-weight: 600; padding: 8px 16px; border-radius: 8px;">
                    Create
                </MudButton>
                <MudButton
                    Variant="Variant.Text"
                    OnClick="@(() => NavigationManager.NavigateTo("/quiz-demo"))"
                    Style="color: #586380; text-transform: none; font-weight: 600; padding: 8px 16px; border-radius: 8px;">
                    Quiz Demo
                </MudButton>
            </div>

            <!-- Search Bar -->
            <MudTextField
                @bind-Value="_searchQuery"
                Placeholder="Search..."
                Variant="Variant.Outlined"
                Adornment="Adornment.Start"
                AdornmentIcon="@Icons.Material.Filled.Search"
                Margin="Margin.Dense"
                Class="search-field"
                Style="min-width: 300px; background-color: #F6F7FB; border-radius: 8px;"/>
        </div>

        <div class="d-flex align-center gap-3">
            <AuthorizeView>
                <Authorized>
                    <!-- Notification Bell -->
                    <MudIconButton Icon="@Icons.Material.Filled.Notifications"
                                   Style="color: #586380;"
                                   Size="Size.Medium"/>

                    <!-- Help Icon -->
                    <MudIconButton Icon="@Icons.Material.Filled.Help"
                                   Style="color: #586380;"
                                   Size="Size.Medium"/>

                    <!-- User Dropdown Menu -->
                    <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight"
                             ActivationEvent="@MouseEvent.LeftClick">
                        <ActivatorContent>
                            <div class="d-flex align-center gap-2 cursor-pointer pa-2"
                                 style="border-radius: 8px; transition: all 0.2s ease;">
                                <MudText Typo="Typo.body1" Style="color: #282E3E; font-weight: 600;">Alex Johnson
                                </MudText>
                                <MudAvatar Size="Size.Medium"
                                           Style="background: linear-gradient(135deg, #4255FF 0%, #6B7FFF 100%); border: 2px solid #F0F0F0;">
                                    <MudText Typo="Typo.body1" Class="text-white fw-bold">AJ</MudText>
                                </MudAvatar>
                                <MudIcon Icon="@Icons.Material.Filled.KeyboardArrowDown"
                                         Style="color: #586380;"
                                         Size="Size.Small"/>
                            </div>
                        </ActivatorContent>
                        <ChildContent>
                            <!-- User Info Header -->
                            <div class="pa-4" style="min-width: 280px;">
                                <div class="d-flex align-center gap-3 mb-3">
                                    <MudAvatar Size="Size.Large"
                                               Style="background: linear-gradient(135deg, #4255FF 0%, #6B7FFF 100%);">
                                        <MudText Typo="Typo.h6" Class="text-white fw-bold">AJ</MudText>
                                    </MudAvatar>
                                    <div>
                                        <MudText Typo="Typo.body1" Class="fw-bold">Alex Johnson</MudText>
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">alex.j@quizmaster.com
                                        </MudText>
                                        <MudChip T="string" Size="Size.Small" Color="Color.Primary"
                                                 Style="margin-top: 4px; height: 20px; font-size: 10px;">
                                            LEVEL 5 QUIZZER
                                        </MudChip>
                                    </div>
                                </div>
                            </div>

                            <MudDivider/>

                            <!-- Menu Items -->
                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/profile"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">My Profile</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/quiz-history"))">
                                <div class="d-flex align-center gap-3 position-relative">
                                    <MudIcon Icon="@Icons.Material.Filled.History" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Quiz History</MudText>
                                    <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Info"
                                             Style="position: absolute; right: 8px; font-size: 8px;"/>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/settings"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Settings</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/help"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Help" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Help & Support</MudText>
                                </div>
                            </MudMenuItem>

                            <MudDivider Class="my-2"/>

                            <MudMenuItem OnClick="@Logout">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Logout" Size="Size.Small"
                                             Color="Color.Error"/>
                                    <MudText Typo="Typo.body2" Color="Color.Error">Log Out</MudText>
                                </div>
                            </MudMenuItem>

                            <!-- Version Footer -->
                            <MudDivider/>
                            <div class="pa-3 text-center">
                                <MudText Typo="Typo.caption" Color="Color.Secondary">v2.4.0</MudText>
                                <div class="d-flex justify-center gap-2 mt-2">
                                    <MudLink Typo="Typo.caption" Color="Color.Secondary">Terms</MudLink>
                                    <MudText Typo="Typo.caption" Color="Color.Secondary">•</MudText>
                                    <MudLink Typo="Typo.caption" Color="Color.Secondary">Privacy</MudLink>
                                </div>
                            </div>
                        </ChildContent>
                    </MudMenu>
                </Authorized>
                <NotAuthorized>
                    <MudButton Color="Color.Secondary" Variant="Variant.Filled" DropShadow="false"
                               OnClick="@(() => NavigationManager.NavigateTo("/login"))">
                        Đăng nhập
                    </MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </MudContainer>
</MudAppBar>


@code {
    private string _searchQuery = "";

    private void Logout()
    {
        ClientAuthHelper.SignOut();
    }

}

