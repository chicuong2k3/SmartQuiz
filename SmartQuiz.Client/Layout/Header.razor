@inject NavigationManager NavigationManager

<MudAppBar Elevation="0" Class="px-4" Style="background-color: #2196F3; height: 60px;">
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="d-flex align-center justify-space-between pa-0">
        <div class="d-flex align-center gap-4">
            <!-- Logo -->
            <div class="d-flex align-center gap-2 cursor-pointer" @onclick="@(() => NavigationManager.NavigateTo("/"))">
                <MudIcon Icon="@Icons.Material.Filled.School" Color="Color.Surface" Size="Size.Large"/>
                <MudText Typo="Typo.h6" Class="fw-bold text-white">QuizMaster</MudText>
            </div>

            <!-- Search Bar -->
            <MudTextField
                @bind-Value="_searchQuery"
                Placeholder="Search..."
                Variant="Variant.Outlined"
                Adornment="Adornment.Start"
                AdornmentIcon="@Icons.Material.Filled.Search"
                Margin="Margin.Dense"
                Class="search-field"
                Style="min-width: 300px; background-color: rgba(255,255,255,0.15); border-radius: 8px;"
                InputClass="text-white"/>
        </div>

        <div class="d-flex align-center gap-3">
            <AuthorizeView>
                <Authorized>
                    <!-- Notification Bell -->
                    <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Surface"
                                   Size="Size.Medium"/>

                    <!-- Help Icon -->
                    <MudIconButton Icon="@Icons.Material.Filled.Help" Color="Color.Surface" Size="Size.Medium"/>

                    <!-- User Dropdown Menu -->
                    <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight"
                             ActivationEvent="@MouseEvent.LeftClick">
                        <ActivatorContent>
                            <div class="d-flex align-center gap-2 cursor-pointer pa-2" style="border-radius: 8px;">
                                <MudText Typo="Typo.body1" Class="text-white fw-semibold">Alex Johnson</MudText>
                                <MudAvatar Size="Size.Medium" Style="background-color: #FF9800;">
                                    <MudText Typo="Typo.body1" Class="text-white fw-bold">AJ</MudText>
                                </MudAvatar>
                                <MudIcon Icon="@Icons.Material.Filled.KeyboardArrowDown" Color="Color.Surface"
                                         Size="Size.Small"/>
                            </div>
                        </ActivatorContent>
                        <ChildContent>
                            <!-- User Info Header -->
                            <div class="pa-4" style="min-width: 280px;">
                                <div class="d-flex align-center gap-3 mb-3">
                                    <MudAvatar Size="Size.Large" Style="background-color: #FF9800;">
                                        <MudText Typo="Typo.h6" Class="text-white fw-bold">AJ</MudText>
                                    </MudAvatar>
                                    <div>
                                        <MudText Typo="Typo.body1" Class="fw-bold">Alex Johnson</MudText>
                                        <MudText Typo="Typo.body2" Color="Color.Secondary">alex.j@quizmaster.com
                                        </MudText>
                                        <MudChip T="string" Size="Size.Small" Color="Color.Primary"
                                                 Style="margin-top: 4px; height: 20px; font-size: 10px;">
                                            LEVEL 5 QUIZZER
                                        </MudChip>
                                    </div>
                                </div>
                            </div>

                            <MudDivider/>

                            <!-- Menu Items -->
                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/profile"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">My Profile</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/quiz-history"))">
                                <div class="d-flex align-center gap-3 position-relative">
                                    <MudIcon Icon="@Icons.Material.Filled.History" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Quiz History</MudText>
                                    <MudIcon Icon="@Icons.Material.Filled.Circle" Size="Size.Small" Color="Color.Info"
                                             Style="position: absolute; right: 8px; font-size: 8px;"/>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/settings"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Settings" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Settings</MudText>
                                </div>
                            </MudMenuItem>

                            <MudMenuItem OnClick="@(() => NavigationManager.NavigateTo("/help"))">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Help" Size="Size.Small"/>
                                    <MudText Typo="Typo.body2">Help & Support</MudText>
                                </div>
                            </MudMenuItem>

                            <MudDivider Class="my-2"/>

                            <MudMenuItem OnClick="@Logout">
                                <div class="d-flex align-center gap-3">
                                    <MudIcon Icon="@Icons.Material.Filled.Logout" Size="Size.Small"
                                             Color="Color.Error"/>
                                    <MudText Typo="Typo.body2" Color="Color.Error">Log Out</MudText>
                                </div>
                            </MudMenuItem>

                            <!-- Version Footer -->
                            <MudDivider/>
                            <div class="pa-3 text-center">
                                <MudText Typo="Typo.caption" Color="Color.Secondary">v2.4.0</MudText>
                                <div class="d-flex justify-center gap-2 mt-2">
                                    <MudLink Typo="Typo.caption" Color="Color.Secondary">Terms</MudLink>
                                    <MudText Typo="Typo.caption" Color="Color.Secondary">â€¢</MudText>
                                    <MudLink Typo="Typo.caption" Color="Color.Secondary">Privacy</MudLink>
                                </div>
                            </div>
                        </ChildContent>
                    </MudMenu>
                </Authorized>
                <NotAuthorized>
                    <MudButton Color="Color.Surface" Variant="Variant.Filled"
                               OnClick="@(() => NavigationManager.NavigateTo("/login"))">
                        Log In
                    </MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </MudContainer>
</MudAppBar>

<style>
    .search-field ::deep .mud-input-root {
        color: white !important;
    }

    .search-field ::deep .mud-input-root::placeholder {
        color: rgba(255, 255, 255, 0.7) !important;
    }

    .search-field ::deep .mud-input-adornment-start {
        color: white !important;
    }

    .search-field ::deep fieldset {
        border-color: rgba(255, 255, 255, 0.3) !important;
    }

    .search-field ::deep .mud-input-root:hover fieldset {
        border-color: rgba(255, 255, 255, 0.5) !important;
    }
</style>

@code {
    private string _searchQuery = "";

    private void Logout()
    {
        NavigationManager.NavigateTo("/logout", true);
    }

}

